CREATE OR REPLACE PROCEDURE "SYSTEM"."RETRIEVE_SWITCH_VALUE_PRC"(
P_IN_SWITCH_NAME IN APPLICATION_SWITCHES.SWITCH_NAME%TYPE,
P_IN_SWITCH_BRAND IN APPLICATION_SWITCHES.BRAND%TYPE,
P_OUT_SWITCH_VALUE OUT VARCHAR2,
P_OUT_ERROR_CODE OUT NUMBER,
P_OUT_ERROR_MESSAGE OUT VARCHAR2

)

AS

l_error_code NUMBER:=0;
l_err_msg VARCHAR2(5000):='SUCCESSFULLY FETCHED';
l_switch_value VARCHAR2(25);
l_switch_brand VARCHAR2(25);
l_switch_name VARCHAR2(25);
incorrect_input_exp EXCEPTION;
PRAGMA EXCEPTION_INIT(incorrect_input_exp,-20004);

BEGIN

P_OUT_ERROR_CODE:=l_error_code;
P_OUT_ERROR_MESSAGE:=l_err_msg;

IF P_OUT_SWITCH_VALUE IS NOT NULL THEN 


BEGIN

l_switch_name:=P_IN_SWITCH_NAME;
l_switch_brand:=P_IN_SWITCH_BRAND;

SELECT REPLACE(SWITCH_VALUE,',') INTO l_switch_value
FROM APPLICATION_SWITCHES WHERE SWITCH_NAME=l_switch_name
AND BRAND IN (SELECT C1 BRAND FROM (SELECT REGEXP_SUBSTR(l_switch_brand,'[^,]+',1,LEVEL) C1 FROM DUAL
CONNECT BY REGEXP_SUBSTR(l_switch_brand,'[^,]+',1,LEVEL) 
IS NOT NULL));

END;

IF l_switch_value IS NOT NULL THEN

P_OUT_SWITCH_VALUE:=l_switch_value;

ELSE


P_OUT_ERROR_CODE:=-20004;
P_OUT_ERROR_MESSAGE:='ORA-2004 INVALID INPUT';

END IF;


ELSE

P_OUT_ERROR_CODE:=-20004;
P_OUT_ERROR_MESSAGE:='ORA-2004 INVALID INPUT';


END IF;

EXCEPTION

WHEN OTHERS THEN

P_OUT_ERROR_CODE:=SQLCODE;
P_OUT_ERROR_MESSAGE:=SUBSTR(SQLERRM,-1,200);

END RETRIEVE_SWITCH_VALUE_PRC;